define(["jquery","angular","angular-route"],function(a){"use strict";function b(b){return function(c){if("application/x-www-form-urlencoded"===b)return a.param(options.data);if("multipart/form-data"===b){var d=new FormData;return angular.forEach(c,function(a,b){d.append(b,a)}),d}return c}}function c(a,c,d,e,f,g){g||(g={}),a.formModel=g,a.formClasses={},a.formErrors={},a.formMessages={},a.checkField=function(b){var c=a["check_"+b];if(c)c.call(a);else{var d=a.form[b];d.$valid?a.formClasses[b]="has-success":d.$dirty&&(a.formErrors[b]=b+" is not valid",a.formClasses[b]="has-error")}},a.showErrors=function(){var b=a.form.$error;angular.forEach(b.required,function(b){a.formClasses[b.$name]="has-error"})},a.processForm=function(d){if(d.preventDefault(),d.stopPropagation(),a.form.$invalid)return a.showErrors();var f=c.attr("enctype")||"",g=f.split(";")[0],h={url:c.attr("action"),method:c.attr("method")||"POST",data:a.formModel,transformRequest:b(g)};("application/x-www-form-urlencoded"===g||"multipart/form-data"===g)&&(h.headers={"content-type":void 0}),a.formMessages={},e(h).success(function(b){b.messages?angular.forEach(b.messages,function(b,c){a.formMessages[c]=b}):window.location.href=b.redirect||"/"}).error(function(){})}}var d={},e={},f=window,g=[];context=angular.extend(e,f.context),d.$=a,d.context=context,d.services=angular.module("lux.services",[]),d.controllers=angular.module("lux.controllers",["lux.services"]),d.app=angular.module("lux",["ngRoute","lux.controllers","lux.services"]),d.ready_callbacks=[],d.addRoute=function(a,b){g.push([a,b])},d._setupRouter=function(b){d.app.config(["$routeProvider","$locationProvider",function(c,d){angular.forEach(b,function(b){var d=(b[0],b[1]);a.isFunction(d)&&(d=d()),c.when("/",d)}),d.html5Mode(!0)}])},d.controllers.controller("page",["$scope","$http","$location",function(b){angular.extend(b,context),b.search_text="",b.logout=function(b,c){b.preventDefault(),b.stopPropagation(),a.post(c).success(function(a){a.redirect&&window.location.replace(a.redirect)})},b.search=function(){b.search_text&&(window.location.href="/search?"+a.param({q:b.search_text}))}}]);return d.app.directive("watchChange",function(){return{scope:{onchange:"&watchChange"},link:function(a,b){b.on("keyup",function(){a.$apply(function(){a.onchange()})}),b.on("change",function(){a.$apply(function(){a.onchange()})})}}}),d.controllers.controller("userController",["$scope","$element","$location","$http","$sce",function(b,d,e,f,g){c(b,d,e,f,g),b.unlink=function(b,c){b.preventDefault(),b.stopPropagation();var d="/oauth/"+c+"/remove";a.post(d).success(function(a){a.success&&$route.reload()})},b.check_password_repeat=function(){var a=this.formModel,b=this.form.password_repeat,c=a.password,d=a.password_repeat;c!==d&&b.$dirty?(this.formErrors.password_repeat="passwords don't match",b.$error.password_repeat=!0,this.formClasses.password_repeat="has-error"):b.$dirty&&(this.formClasses.password_repeat="has-success",delete this.form.$error.password_repeat)}}]),angular.element(document).ready(function(){if(g.length&&context.html5){var a=g;g=[],d._setupRouter(a)}angular.bootstrap(document,["lux"]);var b=d.ready_callbacks;d.ready_callbacks=[],angular.forEach(b,function(a){a()})}),d});