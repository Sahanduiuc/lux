define(["jquery","angular","angular-route","angular-sanitize"],function(a){"use strict";function b(b){return function(c){if("application/x-www-form-urlencoded"===b)return a.param(options.data);if("multipart/form-data"===b){var d=new FormData;return angular.forEach(c,function(a,b){d.append(b,a)}),d}return c}}function c(a,c,d,e,f){f||(f={}),a.formModel=f,a.formClasses={},a.formErrors={},a.formMessages={},a.checkField=function(b){var c=a["check_"+b];if(c)c.call(a);else{var d=a.form[b];d.$valid?a.formClasses[b]="has-success":d.$dirty&&(a.formErrors[b]=b+" is not valid",a.formClasses[b]="has-error")}},a.showErrors=function(){var b=a.form.$error;angular.forEach(b.required,function(b){a.formClasses[b.$name]="has-error"})},a.processForm=function(c){c.preventDefault(),c.stopPropagation();var e=angular.element(c.target);if(a.form.$invalid)return a.showErrors();var f=e.attr("enctype")||"",g=f.split(";")[0],h={url:e.attr("action"),method:e.attr("method")||"POST",data:a.formModel,transformRequest:b(g)};("application/x-www-form-urlencoded"===g||"multipart/form-data"===g)&&(h.headers={"content-type":void 0}),a.formMessages={},d(h).success(function(b){b.messages?angular.forEach(b.messages,function(b,c){a.formMessages[c]=b}):window.location.href=b.redirect||"/"}).error(function(){})}}var d={},e={},f=window,g=[],h=[],i=angular.extend(e,f.context);d.$=a,d.context=i,d.services=angular.module("lux.services",[]),d.controllers=angular.module("lux.controllers",["lux.services"]),d.app=angular.module("lux",["ngRoute","ngSanitize","lux.controllers","lux.services"]),d.addRoute=function(a,b){g.push([a,b])},d.add_ready_callback=function(a){h===!0?a():h.push(a)},d.bootstrap=function(){angular.element(document).ready(function(){if(g.length&&i.html5mode){var a=g;g=[],d._setupRouter(a)}angular.bootstrap(document,["lux"]),angular.forEach(h,function(a){a()}),h=!0})},d._setupRouter=function(b){d.app.config(["$routeProvider","$locationProvider",function(c,d){angular.forEach(b,function(b){var d=b[0],e=b[1];a.isFunction(e)&&(e=e()),c.when(d,e)}),d.html5Mode(!0)}])},d.controllers.controller("page",["$scope","$http","$location",function(b,c){angular.extend(b,i),b.search_text="",b.logout=function(b,c){b.preventDefault(),b.stopPropagation(),a.post(c).success(function(a){a.redirect&&window.location.replace(a.redirect)})},b.search=function(){b.search_text&&(window.location.href="/search?"+a.param({q:b.search_text}))},b.dismiss=function(a){c.post("/_dismiss_message",a)}}]);return d.app.directive("watchChange",function(){return{scope:{onchange:"&watchChange"},link:function(a,b){b.on("keyup",function(){a.$apply(function(){a.onchange()})}),b.on("change",function(){a.$apply(function(){a.onchange()})})}}}),d.controllers.controller("userController",["$scope","$location","$http","$sce",function(b,d,e,f){c(b,d,e,f,i.user),b.unlink=function(b,c){b.preventDefault(),b.stopPropagation();var d="/oauth/"+c+"/remove";a.post(d).success(function(a){a.success&&$route.reload()})},b.check_password_repeat=function(){var a=this.formModel,b=this.form.password_repeat,c=a.password,d=a.password_repeat;c!==d&&b.$dirty?(this.formErrors.password_repeat="passwords don't match",b.$error.password_repeat=!0,this.formClasses.password_repeat="has-error"):b.$dirty&&(this.formClasses.password_repeat="has-success",delete this.form.$error.password_repeat)}}]),d});