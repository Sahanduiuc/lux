define(["lux/config"],function(a){"use strict";var b=a.PATH_TO_LOCAL_REQUIRED_FILES||"";return a.require.paths=a.extend(a.require.paths,{giotto:b+"luxsite/giotto","angular-img-crop":b+"luxsite/ng-img-crop.js",videojs:"//vjs.zencdn.net/4.12/video.js","moment-timezone":"//cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.4.0/moment-timezone-with-data-2010-2020"}),a.config(),a}),define("lux/config/lux",[],function(){"use strict";function a(){var a,b=arguments.length,c=arguments[0],e=0;for(c||(c={});++e<b;)if(a=arguments[e],d(a))for(var f in a)a.hasOwnProperty(f)&&(c[f]=a[f]);return c}function b(a){return"[object String]"===i.call(a)}function c(a){return"[object Array]"===i.call(a)}function d(a){return"[object Object]"===i.call(a)}function e(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(b)))}function f(a){var b=e(a);if(!b)throw new Error("Cannot decode the token");return JSON.parse(b)}var g=window,h=g.lux||{},i=Object.prototype.toString;if(b(h))h={context:f(h)};else if(h.root)return h;return g.lux=h,h.root=g,h.require=a(h.require),h.extend=a,h.isString=b,h.isArray=c,h.isObject=d,h.urlBase64Decode=e,h.urlBase64DecodeToJSON=f,h}),define("lux/config/paths",[],function(){"use strict";return function(){return{angular:"//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular","angular-animate":"//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular-animate","angular-mocks":"//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular-mocks.js","angular-sanitize":"//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular-sanitize","angular-touch":"//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.9/angular-touch","angular-ui-bootstrap":"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.0.3/ui-bootstrap-tpls","angular-ui-router":"//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router","angular-ui-select":"//cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.13.2/select","angular-cookies":"//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.9/angular-cookies","angular-ui-grid":"//cdnjs.cloudflare.com/ajax/libs/angular-ui-grid/3.0.7/ui-grid","angular-scroll":"//cdnjs.cloudflare.com/ajax/libs/angular-scroll/0.7.2/angular-scroll","angular-file-upload":"//cdnjs.cloudflare.com/ajax/libs/danialfarid-angular-file-upload/10.0.2/ng-file-upload","angular-infinite-scroll":"//cdnjs.cloudflare.com/ajax/libs/ngInfiniteScroll/1.2.1/ng-infinite-scroll","angular-moment":"//cdnjs.cloudflare.com/ajax/libs/angular-moment/0.10.1/angular-moment","angular-pusher":"//cdn.jsdelivr.net/angular.pusher/latest/pusher-angular.min.js",videojs:"//vjs.zencdn.net/4.12/video.js",async:"//cdnjs.cloudflare.com/ajax/libs/requirejs-async/0.1.1/async.js",pusher:"//js.pusher.com/2.2/pusher",codemirror:"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/codemirror","codemirror-markdown":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/markdown/markdown","codemirror-javascript":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/javascript/javascript","codemirror-python":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/python/python.js","codemirror-xml":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/xml/xml","codemirror-css":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/css/css","codemirror-htmlmixed":"//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/htmlmixed/htmlmixed",crossfilter:"//cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.11/crossfilter",d3:"//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3","google-analytics":"//www.google-analytics.com/analytics.js",gridster:"//cdnjs.cloudflare.com/ajax/libs/jquery.gridster/0.5.6/jquery.gridster",holder:"//cdnjs.cloudflare.com/ajax/libs/holder/2.3.1/holder",highlight:"//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js",katex:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js",leaflet:"//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js",lodash:"//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash",marked:"//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked",mathjax:"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML",moment:"//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment",restangular:"//cdnjs.cloudflare.com/ajax/libs/restangular/1.4.0/restangular",sockjs:"//cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.0.3/sockjs",stats:"//cdnjs.cloudflare.com/ajax/libs/stats.js/r11/Stats",topojson:"//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson"}}}),define("lux/config/shim",[],function(){"use strict";return function(a){return{angular:{exports:"angular"},"angular-strap-tpl":{deps:["angular","angular-strap"]},"google-analytics":{exports:a.GoogleAnalyticsObject||"ga"},highlight:{exports:"hljs"},codemirror:{exports:"CodeMirror"},"codemirror-htmlmixed":{deps:["codemirror","codemirror-xml","codemirror-javascript","codemirror-css"]},restangular:{deps:["angular"]},crossfilter:{exports:"crossfilter"},trianglify:{deps:["d3"],exports:"Trianglify"},mathjax:{exports:"MathJax"}}}}),define("lux/config",["lux/config/lux","lux/config/paths","lux/config/shim"],function(a,b,c){"use strict";function d(c){var d={},e=f()?".min":"",j=g.local_require_prefix,k=a.extend(b(),c.paths);for(var l in k)if(k.hasOwnProperty(l)){var m=k[l];if(j&&m.substring(0,j.length)===j&&(m=m.substring(j.length)),c.shim[l]||("angular-"===l.substring(0,8)?c.shim[l]={deps:["angular"]}:"d3-"===l.substring(0,3)?c.shim[l]={deps:["d3"]}:"codemirror-"===l.substring(0,11)&&(c.shim[l]={deps:["codemirror"]})),"string"!=typeof m)m=m.url;else{var n=m.split("?");2===n.length?(m=n[0],n=n[1]):n="",m.substring(m.length-3)!==i&&(m+=e),n&&(m.substring(m.length-3)!==i&&(m+=i),m+="?"+n),"//"===m.substring(0,2)&&h&&(m=h+m),m.substring(m.length-3)===i&&(m=m.substring(0,m.length-3))}d[l]=m}return d}function e(){return a.context?a.context.MEDIA_URL:void 0}function f(){return a.context?a.context.MINIFIED_MEDIA:void 0}var g=a.root,h=g.location&&"file:"===g.location.protocol?"http:":"",i=".js";return a.config=function(b){if(b=a.extend(b,a.require),!b.baseUrl){var f=e();void 0!==f&&(b.baseUrl=f)}b.shim=a.extend(c(g),b.shim),b.paths=d(b),require.config(b)},a}),define("require.config",["lux/config"],function(a){"use strict";var b=a.PATH_TO_LOCAL_REQUIRED_FILES||"";return a.require.paths=a.extend(a.require.paths,{giotto:b+"luxsite/giotto","angular-img-crop":b+"luxsite/ng-img-crop.js",videojs:"//vjs.zencdn.net/4.12/video.js","moment-timezone":"//cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.4.0/moment-timezone-with-data-2010-2020"}),a.config(),a}),define("lux/core/utils",["angular","lux/config"],function(a,b){"use strict";function c(a,b){for(var c=b.split("."),d=0;d<c.length&&(a=a[c[d]],a);++d);return"function"==typeof a&&(a=a()),a}var d=b.root,e=a.forEach,f=Array.prototype.slice,g=function(){var a=[],b=function(){var b=this,c=f.call(arguments,0);a.forEach(function(a){a.apply(b,c)})};return b.add=function(b){a.push(b)},b};b.addEvent=function(a,b,c){var d=a[b];d||(a[b]=d=g()),d.add&&d.add(c)},b.windowResize=function(a){b.addEvent(window,"onresize",a)},b.windowHeight=function(){return window.innerHeight>0?window.innerHeight:screen.availHeight},b.isAbsolute=new RegExp("^([a-z]+://|//)"),b.isTag=function(b,c){return b=a.element(b),1===b.length&&b[0].tagName===c.toUpperCase()},b.joinUrl=function(){for(var a,b="",c=0;c<arguments.length;++c)if(a=arguments[c]){for(var d=a,e=!1;b&&"/"===d.substring(0,1);)d=d.substring(1);for(;"/"===d.substring(d.length-1);)e=!0,d=d.substring(0,d.length-1);d&&(b&&"/"!==b.substring(b.length-1)&&(b+="/"),b+=d,e&&(b+="/"))}return b},b.getOptions=function(e,f){var g;return e&&(f&&(g=e[f]),g||(f="options",g=e[f]),a.isString(g)&&(g=c(d,g)),a.isFunction(g)&&(g=g())),g||(g={}),b.isObject(g)&&a.forEach(e,function(a,b){"$"!==b.substring(0,1)&&b!==f&&(g[b]=a)}),g},b.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},b.extendArray=function(){if(arguments.length){var a=arguments[0],b=function(b){a.push(b)};if("function"==typeof a.push)for(var c=1;c<arguments.length;++c)e(arguments[c],b);return a}},b.querySelector=function(c,d){return 1===arguments.length&&b.isString(c)&&(d=c,c=document),c=a.element(c),c.length&&d?a.element(c[0].querySelector(d)):c};var h={};return b.loadCss=function(a){if(!h[a]){h[a]=!0;var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)}},b.globalEval=function(a){a&&(d.execScript||function(a){d.eval.call(d,a)})(a)},b.slugify=function(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},b.now=function(){return Date.now?Date.now():(new Date).getTime()},b.size=function(a){if(!a)return 0;if(void 0!==a.length)return a.length;var b=0;return e(a,function(){++b}),b},b.getObject=function(a,b,f){var g,h=a[b],i=[b,"class","style"];return h&&(f&&(g=c(f,h)),g||(g=c(d,h))),g||(g={}),e(a,function(a,b){"$"!==b.substring(0,1)&&-1===i.indexOf(b)&&(g[b]=a)}),g},b.formatString=function(a,b){return a.replace(/{(\w+)}/g,function(a,c){return b.hasOwnProperty(c)?b[c]:""})},b.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},b.getJsonOrNone=function(a){try{return JSON.parse(a)}catch(b){return null}},b.isJsonStringify=function(a){return b.isObject(a)||b.isArray(a)||b.isString(a)?!0:!1},b.stateHref=function(a,b,c){if(c){var d=a.href(b,c);return d.replace(/%2F/g,"/")}return a.href(b)},b}),define("lux/core/message",["lux/config"],function(a){"use strict";function b(b,c){return a.isString(c)&&(c={text:c}),c.type=b,c}return a.messageService={pushMessage:function(){},debug:function(a){this.pushMessage(b("debug",a))},info:function(a){this.pushMessage(b("info",a))},success:function(a){this.pushMessage(b("success",a))},warn:function(a){this.pushMessage(b("warn",a))},error:function(a){this.pushMessage(b("error",a))},log:function(a,b){var c=b.type;"success"===c&&(c="info"),a[c](b.text)}},a.messages=a.extend(a.messages),a.messageService}),define("lux/core/api",["angular","lux/config"],function(a,b){"use strict";function c(){function b(c,d){return c.options=function(){return d},a.forEach(b,function(a,b){c[b]=a}),c}return b.success=function(c){return b(this.then(function(b){var d=c(b.data,b.status,b.headers);return a.isUndefined(d)?b:d}),this.options())},b.error=function(c){return b(this.then(null,function(b){var d=c(b.data,b.status,b.headers);return a.isUndefined(d)?b:d}),this.options())},b}var d=a.extend;b.messages.no_api=function(a){return{text:'Api client for "'+a+'" is not available',icon:"fa fa-exclamation-triangle"}},a.module("lux.services",[]).constant("loginUrl",b.context.LOGIN_URL||"").constant("postLoginUrl",b.context.POST_LOGIN_URL||"/").value("ApiTypes",{}).value("AuthApis",{}).run(["$window","$lux",function(b,c){var d=b.document,e=a.element(d.querySelector("meta[name=csrf-param]")).attr("content"),f=a.element(d.querySelector("meta[name=csrf-token]")).attr("content");c.user_token=a.element(d.querySelector("meta[name=user-token]")).attr("content"),e&&f&&(c.csrf={},c.csrf[e]=f)}]).factory("luxHttpPromise",[function(){return c()}]).factory("$lux",["$location","$window","$q","$http","$log","$timeout","ApiTypes","AuthApis","$templateCache","$compile","$rootScope","luxHttpPromise",function(c,e,f,g,h,i,j,k,l,m,n,o){function p(c,d){if(1===arguments.length){var e;if(a.isObject(c)&&(e=c,c=c.url),d=j[c])return d(c,this).defaults(e);u.messages.error(b.messages.no_api(c))}else if(2===arguments.length)return j[c]=d,d(c,this)}function q(a,b){return 1===arguments.length?k[a.baseUrl()]:void(2===arguments.length&&(k[a.baseUrl()]=b))}function r(b){return function(c){if(c=d(c||{},u.csrf),"application/x-www-form-urlencoded"===b)return a.element.param(c);if("multipart/form-data"===b){var e=new FormData;return a.forEach(c,function(a,b){e.append(b,a)}),e}return a.toJson(c)}}function s(a,b,c,d){var e=l.get(a);e?t(b,e,c,d):g.get(a).then(function(f){e=f.data,l.put(a,e),t(b,e,c,d)},function(){u.messages.error("Could not load template from "+a)})}function t(a,b,c,d){var e=m(b)(c);a.append(e),d&&d(e)}var u={location:c,window:e,log:h,http:g,q:f,timeout:i,templateCache:l,compile:m,apiUrls:{},promise:o,api:p,authApi:q,formData:r,renderTemplate:s,messages:d({},b.messageService,{pushMessage:function(a){this.log(h,a),n.$broadcast("messageAdded",a)}})};return u}]);var e=["delete","get","head","options"];return b.apiFactory=function(c,f){function g(a){if(!a.baseUrl&&a.name){var d=f.apiUrls[c];if(!d)return h.populateApiUrls(c).then(function(){g(a)},a.error);if(a.baseUrl=d[a.name],!a.baseUrl)return a.error("Could not find a valid url for "+a.name)}a.baseUrl||(a.baseUrl=h.baseUrl());var e=a.options;if(!e.url){var i=a.baseUrl;e.path&&(i=b.joinUrl(a.baseUrl,e.path)),e.url=i}h.httpOptions(a),h.authentication(a);var j=a.options;j.url?(f.log.info("Executing HTTP "+j.method+" request @ "+j.url),f.http(j).then(a.success,a.error)):a.error("Api url not available")}var h={},i={};return h.toString=function(){return i.name?b.joinUrl(h.baseUrl(),i.name):h.baseUrl()},h.defaults=function(a){return arguments.length?(a&&(i=a),h):i},h.formReady=function(){f.log.error("Cannot handle form ready")},h.baseUrl=function(){return c},h.get=function(a,b){return h.request("get",a,b)},h.post=function(a,b){return h.request("post",a,b)},h.put=function(a,b){return h.request("put",a,b)},h.head=function(a,b){return h.request("head",a,b)},h["delete"]=function(a,b){return h.request("delete",a,b)},h.httpOptions=function(){},h.authentication=function(){},h.user=function(){},h.request=function(b,c,i){var j=d({},h.defaults());j.method=b.toLowerCase(),-1===e.indexOf(j.method)?j.data=i:(a.isObject(j.params)||(j.params={}),d(j.params,i||{})),c=d(j,c);var k=f.q.defer(),l={name:c.name,deferred:k,on:f.promise(k.promise,c),options:c,error:function(b){a.isString(b.data)&&(b.data={error:!0,message:i}),k.reject(b)},success:function(b){a.isString(b.data)&&(b.data={message:i}),!b.data||b.data.error?k.reject(b):k.resolve(b)}};return delete c.name,c.url===h.baseUrl()&&delete c.url,g(l),l.on},h.populateApiUrls=function(){return f.log.info("Fetching api info"),f.http.get(c).then(function(a){return f.apiUrls[c]=a.data,a.data})},h.getApiNames=function(){var b,d;return a.isObject(f.apiUrls[c])?(d=f.q.defer(),b=d.promise,d.resolve(f.apiUrls[c])):b=h.populateApiUrls(),b},h.getUrlForTarget=function(a){return h.getApiNames().then(function(c){var d=c[a.name];return a.path&&(d=b.joinUrl(d,a.path)),d})},h},b.apiFactory}),define("lux/core",["lux/core/utils","lux/core/message","lux/core/api"],function(a){"use strict";return a}),define("lux",["angular","lux/core"],function(a,b){"use strict";var c=a.extend,d=!1,e={url:"",MEDIA_URL:"",hashPrefix:"",ngModules:[]};return b.forEach=a.forEach,b.context=c({},e,b.context),b.version=b.context.lux_version,b.media=function(a,c){return c||(c=b.context),b.joinUrl(c.url,c.MEDIA_URL,a)},b.loader=a.module("lux.loader",[]).value("context",b.context).config(["$controllerProvider",function(a){b.loader.cp=a,b.loader.controller=a}]).run(["$rootScope","$log","$timeout","context",function(a,b,d,e){b.info("Extend root scope with context"),c(a,e),a.$timeout=d,a.$log=b}]),b.bootstrap=function(c,e){function f(){var d=b.context.ngModules;d||(d=[]),b.forEach(e,function(a){d.push(a)}),d.splice(0,0,"lux.loader"),a.module(c,d),a.bootstrap(document,[c])}d||(d=!0,a.element(document).ready(function(){f()}))},b}),define("lux/forms/handlers",["angular","lux"],function(a){"use strict";a.module("lux.form.handlers",["lux.services"]).run(["$window","$lux","loginUrl","postLoginUrl",function(a,b,c,d){var e={};b.formHandlers=e,e.reload=function(){a.location.reload()},e.redirectHome=function(b,c){var d=c.formAttrs.redirectTo||"/";a.location.href=d},e.login=function(c,e){var f=e.formAttrs.action,g=b.api(f);g&&g.token(c.data.token),a.location.href=d},e.passwordRecovery=function(a){var c=a.data.email;if(c){var d="We have sent an email to <strong>"+c+"</strong>. Please follow the instructions to change your password.";b.messages.success(d)}else b.messages.error("Could not find that email")},e.signUp=function(a){var c=a.data.email;if(c){var d="We have sent an email to <strong>"+c+"</strong>. Please follow the instructions to confirm your email.";b.messages.success(d)}else b.messages.error("Something wrong, please contact the administrator")},e.passwordChanged=function(a){if(a.data.success){var d='Password succesfully changed. You can now <a title="login" href="'+c+'">login</a> again.';b.messages.success(d)}else b.messages.error("Could not change password")},e.enquiry=function(a){if(a.data.success){var c="Thank you for your feedback!";b.messages.success(c)}else b.messages.error("Feedback form error")}}])}),define("lux/forms/process",["angular","lux","lux/forms/handlers"],function(a,b){"use strict";function c(b,c){function e(){var a=d[c.formProcessor||"default"];return f.$pending=!0,c.formMessages={},a(b,e)}var f=c[c.formName];return e.form=f,e.model=c[c.formModelName],e.attrs=c.formAttrs,e.target=c.formAttrs.action,e.method=c.formAttrs.method||"post",e.api=a.isObject(e.target)?b.api(e.target):null,e}var d={};return a.module("lux.form.process",[]).run(["$lux",function(a){b.processForm=function(b){function d(a){return f.form.$pending=!1,a.data||{}}b.preventDefault(),b.stopPropagation();var e=this,f=c(a,e);if(f.form.$setSubmitted(),f.form.$invalid)return void f.form.$setDirty();var g=f();return g?void g.then(function(b){var c=d(b),g=f.attrs.resultHandler,h=g&&a.formHandlers[g];if(h)h(b,e);else if(c.messages)e.addMessages(c.messages);else if(f.api){var i=c.message;i||(i=201===b.status?"Successfully created":"Successfully updated"),a.messages.info(i)}},function(b){var c=d(b);if(c.errors)e.addMessages(c.errors,"error");else{var f=c.message;if(!f){var g=g||c.status||501;f="Response error ("+g+")"}a.messages.error(f)}}):void a.log.error("Could not process form. No target or api")}}]),d["default"]=function(a,b){if(b.api)return b.api.request(b.method,b.target,b.model);if(b.target){var c=b.attrs.enctype||"application/json",d=c.split(";")[0],e={url:b.target,method:b.method,data:b.model,transformRequest:a.formData(d)};return"application/x-www-form-urlencoded"===d||"multipart/form-data"===d?e.headers={"content-type":void 0}:e.headers={"content-type":d},a.http(e)}},d}),define("lux/services/luxweb",["angular","lux"],function(a,b){"use strict";a.module("lux.webapi",["lux.services"]).run(["$rootScope","$lux",function(a,b){a.API_URL&&b.api(a.API_URL,d).scopeApi(a)}]),b.decodeJWToken=function(a){var c=a.split(".");if(3!==c.length)throw new Error("JWT must have 3 parts");return b.urlBase64DecodeToJSON(c[1])};var c=["get","head","options"],d=function(d,e){var f=b.apiFactory(d,e),g=f.request,h="authorizations_url";return f.authName=function(a){return 1===arguments.length?(h=a,f):h},f.token=function(){return e.user_token},f.logout=function(a){var c=e.authApi(f);return c?(a.$emit("pre-logout"),void c.post({name:c.authName(),path:b.context.LOGOUT_URL}).then(function(){a.$emit("after-logout"),b.context.POST_LOGOUT_URL?e.window.location.href=b.context.POST_LOGOUT_URL:e.window.location.reload()},function(){e.messages.error("Error while logging out")})):void e.messages.error("Error while logging out")},f.user=function(){var a=f.token();if(a){var c=b.decodeJWToken(a);return c.token=a,c}},f.login=function(){b.context.LOGIN_URL&&(e.window.location.href=b.context.LOGIN_URL,e.window.reload())},f.formReady=function(c,d){var e=f.defaults().get;e&&f.get().success(function(e){b.forEach(e,function(e,f){var g=d[d.formModelName+"Type"],h=f.split("[]")[0];"json"===g[h]&&b.isJsonStringify(e)&&(a.isArray(e)&&(f=h),e=a.toJson(e,null,4)),a.isArray(e)?(c[f]=[],a.forEach(e,function(a){c[f].push(a.id||a)})):c[f]=e.id||e})})},f.request=function(a,b,c){var d=g.call(f,a,b,c);return d.error(function(a,c){401===c?f.login():c?404===c&&e.log.info("Endpoint not found"+(b.path?" @ "+b.path:"")):e.log.error("Server down, could not complete request")}),d},f.httpOptions=function(b){var d=b.options;e.csrf&&c.indexOf(-1===d.method)&&(d.data=a.extend(d.data||{},e.csrf)),d.headers||(d.headers={}),d.headers["Content-Type"]="application/json"},f.scopeApi=function(a,b){b&&(e.authApi(f,b),b.authName(null)),a.api=function(){return e.api(d)},a.getUser=function(){return f.user()},a.logout=function(b){b&&b.preventDefault&&(b.preventDefault(),b.stopPropagation()),f.user()&&f.logout(a)}},f};return d}),define("lux/services/luxrest",["angular","lux","lux/services/luxweb"],function(a,b,c){"use strict";a.module("lux.restapi",["lux.services"]).run(["$rootScope","$lux",function(a,b){if(a.API_URL){var e=b.api("",c);b.api(a.API_URL,d).scopeApi(a,e)}}]);var d=function(a,b){var d=c(a,b);return d.httpOptions=function(a){var b=a.options,c=b.headers;c||(b.headers=c={}),c["Content-Type"]="application/json"},d.authentication=function(a){if("authorizations_url"===a.name&&a.options.url===a.baseUrl&&"post"===a.options.method)a.on.success(function(){b.window.location.reload()});else{var c=d.token();if(c){var e=a.options.headers;e||(a.options.headers=e={}),e.Authorization="Bearer "+c}}},d};return d}),define("lux/services",["lux","lux/services/luxweb","lux/services/luxrest"],function(a){"use strict";return a}),define("lux/services/pagination",["angular","lux/services"],function(a){"use strict";a.module("lux.pagination",["lux.services"]).factory("luxPaginationFactory",["$lux",function(a){function b(b,c,d){this.scope=b,this.target=c,this.orgUrl=this.target.url,this.api=a.api(this.target),d===!0&&(this.recursive=!0)}return b.prototype.getData=function(a,b){this.params=a?a:null,b&&(this.cb=b),this.api.get(null,this.params).then(function(a){this.searchField&&(a.searched=!0,delete this.params[this.searchField]),this.cb(a),this.updateUrls(a)}.bind(this),function(a){this.cb(a)}.bind(this))},b.prototype.updateUrls=function(a){a&&a.data&&a.data.last&&(this.urls={last:a.data.last,next:a.data.next?a.data.next:!1},this.recursive?this.loadMore():this.emitEvent())},b.prototype.emitEvent=function(){this.scope.$emit("moreData")},b.prototype.loadMore=function(){if(!this.urls.next&&!this.urls.last)throw"Updated URLs not set.";this.urls.next===!1?this.target.url=this.urls.last:this.urls.next&&(this.target.url=this.urls.next),this.getData(this.params)},b.prototype.search=function(a,b){this.searchField=b,this.params=this.params||{},this.params[this.searchField]=a,this.target.url=this.orgUrl,this.getData(this.params)},b}])}),define("lux/forms/utils",["angular","lux","lux/services/pagination"],function(a,b){"use strict";a.module("lux.form.utils",["lux.pagination"]).constant("lazyLoadOffset",40).directive("remoteOptions",["$lux","luxPaginationFactory","lazyLoadOffset",function(c,d,e){function f(d,f,g,h,i){function j(b){var c=i[0].querySelector(".ui-select-choices");if(b.stopPropagation(),c){var f=c.querySelector(".ui-select-choices-group");c=a.element(c),c.on("scroll",function(){var a=f.clientHeight-this.clientHeight-e;this.scrollTop>a&&(c.off(),d.loadMore())})}}function k(){v.data().onKeyUp||(v.data("onKeyUp",!0),v.on("keyup",function(a){var b=a.srcElement.value,c="id"===h.remoteOptionsId?q.source:h.remoteOptionsId;m(),b.length>3&&d.search(b,c)}))}function l(c){a.forEach(c.data.result,function(a){var d;d=r?b.formatString(q.source,a):a[q.source],u.push({id:a[p],name:d,searched:c.searched?!0:!1})}),n()}function m(){for(var a=0;a<u.length;a++)u[a].searched&&u.splice(a,1)}function n(){c.timeout(function(){return g.$select.selected}).then(function(a){for(var b=0;b<u.length;b++)for(var c=0;c<a.length;c++)u[b].id===a[c].id&&u.splice(b,1)})}function o(a){if(a.data&&a.data.error)throw u.splice(0,1,{id:"placeholder",name:"Unable to load data..."}),new Error(a.data.message);l(a)}var p=h.remoteOptionsId||"id",q=h.remoteOptionsValue?a.fromJson(h.remoteOptionsValue):{type:"field",source:"id"},r="formatString"===q.type,s={},t=a.fromJson(h.remoteOptionsParams||"{}"),u=[],v=a.element(i[0].querySelector("input[type=text]"));g[f.name]=u,s.id="",s.name="Loading...",u.push(s),a.isUndefined(g[g.formModelName][h.name])&&(g[g.formModelName][h.name]=""),h.multiple?(t.limit=200,t.sortby=q.source?q.source+":asc":"id:asc",u.splice(0,1)):(t.sortby=t.sortby?t.sortby+":asc":"id:asc",u[0]={name:"Please select...",id:"placeholder"}),d.getData(t,o),g.$on("moreData",function(a){j(a),k()})}function g(b,c,e){if(e.remoteOptions){var g=a.fromJson(e.remoteOptions),h=new d(b,g,e.multiple?!0:!1);if(h&&g.name)return f(h,g,b,e,c)}}return{link:g}}]).directive("selectOnClick",["$window",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).directive("checkRepeat",["$log",function(a){return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=c.inheritedData("$formController")[d.checkRepeat];f?(e.$parsers.push(function(a){return a===f.$viewValue?(e.$setValidity("repeat",!0),a):void e.$setValidity("repeat",!1)}),f.$parsers.push(function(a){return e.$setValidity("repeat",a===e.$viewValue),a})):a.error("Check repeat directive could not find "+d.checkRepeat)}}}])}),define("lux/forms",["angular","lux","lux/forms/process","lux/forms/utils","lux/forms/handlers"],function(a,b,c){"use strict";function d(a,c){return a=h({},a,c),b.forms.overrides.forEach(function(b){b(a)}),a}function e(a,b,c){return a+'["'+b+'"].'+c}function f(a){function b(b,c){a.dateTypes.indexOf(b.field.type)>-1&&c.attr("format-date","")}return b}function g(c,d){return a.forEach(b.forms.directives,function(a){a(c,d)}),d}var h=a.extend,i=a.forEach,j=b.extendArray,k=b.isString,l=b.isObject,m=b.isArray,n=["id","name","title","style"],o=j([],n,["disabled","readonly","type","value","placeholder","autocapitalize","autocorrect"]),p=j([],n,["disabled","readonly","placeholder","rows","cols"]),q=j([],n,["disabled"]),r=j([],n,["accept-charset","autocomplete","enctype","method","novalidate","target"]),s=["minlength","maxlength","min","max","required"],t=["disabled","minlength","maxlength","required"],u=function(){return"f"+b.s4()};return b.forms={overrides:[],directives:[],processors:c},a.module("lux.form",["lux.form.utils","lux.form.handlers","lux.form.process"]).constant("formDefaults",{layout:"default",labelSpan:2,debounce:500,showLabels:!0,novalidate:!0,dateTypes:["date","datetime","datetime-local"],defaultDatePlaceholder:"YYYY-MM-DD",formErrorClass:"form-error",FORMKEY:"m__form",useNgFileUpload:!0}).constant("defaultFormElements",function(){return{text:{element:"input",type:"text",editable:!0,textBased:!0},date:{element:"input",type:"date",editable:!0,textBased:!0},datetime:{element:"input",type:"datetime",editable:!0,textBased:!0},"datetime-local":{element:"input",type:"datetime-local",editable:!0,textBased:!0},email:{element:"input",type:"email",editable:!0,textBased:!0},month:{element:"input",type:"month",editable:!0,textBased:!0},number:{element:"input",type:"number",editable:!0,textBased:!0},password:{element:"input",type:"password",editable:!0,textBased:!0},search:{element:"input",type:"search",editable:!0,textBased:!0},tel:{element:"input",type:"tel",editable:!0,textBased:!0},textarea:{element:"textarea",editable:!0,textBased:!0},time:{element:"input",type:"time",editable:!0,textBased:!0},url:{element:"input",type:"url",editable:!0,textBased:!0},week:{element:"input",type:"week",editable:!0,textBased:!0},checkbox:{element:"input",type:"checkbox",editable:!0,textBased:!1},color:{element:"input",type:"color",editable:!0,textBased:!1},file:{element:"input",type:"file",editable:!0,textBased:!1},range:{element:"input",type:"range",editable:!0,textBased:!1},select:{element:"select",editable:!0,textBased:!1},checklist:{element:"div",editable:!1,textBased:!1},fieldset:{element:"fieldset",editable:!1,textBased:!1},div:{element:"div",editable:!1,textBased:!1},form:{element:"form",editable:!1,textBased:!1},radio:{element:"div",editable:!1,textBased:!1},button:{element:"button",type:"button",editable:!1,textBased:!1},hidden:{element:"input",type:"hidden",editable:!1,textBased:!1},image:{element:"input",type:"image",editable:!1,textBased:!1},legend:{element:"legend",editable:!1,textBased:!1},reset:{element:"button",type:"reset",editable:!1,textBased:!1},submit:{element:"button",type:"submit",editable:!1,textBased:!1}}}).factory("formElements",["defaultFormElements",function(a){return a}]).run(["$rootScope","$lux","formDefaults",function(a,c,d){a.$on("formReady",function(a,e,g){var h=g.formAttrs,i=h?h.action:null,j=h?h.actionType:null;if(l(i)&&"create"!==j){var k=c.api(i);k&&(c.log.info("Form "+g.formModelName+' registered with "'+k.toString()+'" api'),k.formReady(e,g))}b.forms.directives.push(f(d))})}]).factory("baseForm",["$log","$http","$document","$templateCache","formDefaults","formElements",function(c,d,f,j,k,l){function n(a){return d.get(a,{cache:j}).then(function(a){return a.data})}function u(b,c){if(!m(c))return a.element(c[0].querySelector(b));for(var d=0;d<c.length;++d)if(c[0].tagName===b)return c}var v=l();return{name:"default",elements:v,className:"",inputGroupClass:"form-group",inputHiddenClass:"form-hidden",inputClass:"form-control",buttonClass:"btn btn-default",template:n,createElement:function(d,e){function f(a,c,d){var f=a+"Type",g=b.getJsonOrNone(c.text_edit);e[f]=e[f]||{},null!==g?e[f][c.name]=g.mode||"":e[f][c.name]=d}var g,j,l=this,n=e.field,o=n.type.split("."),p=v[o.splice(0,1)[0]];e.extraClasses=o.join(" "),e.info=p,p&&(j=p.type&&a.isFunction(l[p.type])?p.type:p.element),g=l[j],f(e.formModelName,n,j),g||(g=l.renderNotElements);var q=g.call(l,e);return i(e.children,function(b){var f=b.field;f?(i(k,function(b,c){a.isUndefined(f[c])&&(f[c]=e.field[c])}),a.isUndefined(b.children)&&(b.children=null),b=d.createElement(h(e,b)),m(b)?i(b,function(a){q.append(a)}):b&&q.append(b)):c.error("form child without field")}),e.field=n,q},addAttrs:function(a,b,c){return i(a.field,function(a,d){c.indexOf(d)>-1?t.indexOf(d)>-1?b.attr("ng-"+d,a):b.attr(d,a):"data-"===d.substring(0,5)&&b.attr(d,a)}),b},renderNotForm:function(b){var c=b.field;return a.element(f[0].createElement("span")).html(c.label||"")},fillDefaults:function(a){var b=a.field;b.label=b.label||b.name,a.formCount++,b.id||(b.id=b.name+"-"+a.formid+"-"+a.formCount)},form:function(b){var c=b.field,d=b.info,e=a.element(f[0].createElement(d.element)).attr("role","form").addClass(this.className).attr("ng-model",c.model);return this.formMessages(b,e),this.addAttrs(b,e,r)},"ng-form":function(a){return this.form(a)},fieldset:function(b){var c=b.field,d=b.info,e=a.element(f[0].createElement(d.element));return c.label&&e.append(a.element(f[0].createElement("legend")).html(c.label)),e},div:function(b){var c=b.info,d=a.element(f[0].createElement(c.element)).addClass(b.extraClasses);return d},radio:function(b){this.fillDefaults(b);var c=b.field,d=b.info,e=a.element(f[0].createElement(d.element)),g=a.element(f[0].createElement("label")).attr("for",c.id),h=a.element(f[0].createElement("span")).css("margin-left","5px").css("position","relative").css("bottom","2px").html(c.label),j=a.element(f[0].createElement("div")).addClass(this.element);return e.attr("ng-model",b.formModelName+'["'+c.name+'"]'),i(o,function(a){c[a]&&e.attr(a,c[a])}),g.append(e).append(h),j.append(g),this.onChange(b,this.inputError(b,j))},checkbox:function(a){return this.radio(a)},input:function(b,c){this.fillDefaults(b);var d,e=b.field,h=b.info,i=a.element(f[0].createElement(h.element)).addClass(this.inputClass),j=a.element(f[0].createElement("label")).attr("for",e.id).html(e.label),l=a.extend({},e.modelOptions,b.inputModelOptions);return i.attr("ng-model",b.formModelName+'["'+e.name+'"]'),i.attr("ng-model-options",a.toJson(l)),"date"===e.type&&a.isUndefined(e.placeholder)&&(e.placeholder=k.defaultDatePlaceholder),
e.showLabels&&"hidden"!==e.type||(j.addClass("sr-only"),a.isUndefined(e.placeholder)&&(e.placeholder=e.label)),this.addAttrs(b,i,c||o),a.isDefined(e.value)&&(b[b.formModelName][e.name]=e.value,h.textBased&&i.attr("value",e.value)),i=g(b,i),this.inputGroupClass?(d=a.element(f[0].createElement("div")),"hidden"===e.type?d.addClass(this.inputHiddenClass):d.addClass(this.inputGroupClass),d.append(j).append(i)):d=[j,i],this.onChange(b,this.inputError(b,d))},textarea:function(a){return this.input(a,p)},select:function(b){var c,d=b.field,e={},f=[],g=[];i(d.options,function(b){a.isString(b)?b={value:b}:m(b)&&(b={value:b[0],repr:b[1]||b[0]}),b.group?(c=e[b.group],c||(c={name:b.group,options:[]},e[b.group]=c,f.push(c)),c.options.push(b)):g.push(b),d.value||(d.value=b.value)});var h=this.input(b);return this.selectWidget(b,h,d,f,g),this.onChange(b,h)},selectWidget:function(b,c,d,e,g){var h,j,l=u(b.info.element,c);!d.multiple&&a.isUndefined(d["data-remote-options"])&&(j=a.element(f[0].createElement("option")).attr("value","").text(d.placeholder||k.defaultSelectPlaceholder),d.required&&j.prop("disabled",!0),l.append(j),a.isUndefined(d.value)&&(d.value="")),e.length?(g.length&&e.push({name:"other",options:g}),i(e,function(b){h=a.element(f[0].createElement("optgroup")).attr("label",b.name),l.append(h),i(b.options,function(b){b=a.element(f[0].createElement("option")).attr("value",b.value).html(b.repr||b.value),h.append(b)})})):i(g,function(b){b=a.element(f[0].createElement("option")).attr("value",b.value).html(b.repr||b.value),l.append(b)}),d.multiple&&l.attr("multiple",!0)},button:function(b){var c=b.field,d=b.info,e=a.element(f[0].createElement(d.element)).addClass(this.buttonClass);return c.name=c.name||d.element,c.label=c.label||c.name,e.html(c.label),this.addAttrs(b,e,q),this.onClick(b,e)},onClick:function(d,e){var f=e.attr("name"),g=d.field,h=f+"Click",i=this;return d[h]=function(e){if(!d.$broadcast(h,e).defaultPrevented&&!d.$emit(h,e).defaultPrevented){var f=i.processForm(d);return g.click&&(f=b.getObject(g,"click",d),!a.isFunction(f))?void c.error('Could not locate click function "'+g.click+'" for button'):void f.call(this,e)}},e.attr("ng-click",h+"($event)"),e},onChange:function(b,c){var d=b.field,e=a.element(c[0].querySelector(b.info.element));return e.attr("ng-change",'fireFieldChange("'+d.name+'")'),c},inputError:function(b,c){var d,g,h=b.field,j=this,k=b.formName+".$submitted",l=e(b.formName,h.name,"$dirty"),m=e(b.formName,h.name,"$invalid"),n=e(b.formName,h.name,"$error")+".",o=a.element(c[0].querySelector(b.info.element)),p=a.element(f[0].createElement("p")).attr("ng-show","("+k+" || "+l+") && "+m).addClass("text-danger error-block").addClass(b.formErrorClass);i(s,function(c){d=h[c],g=c,a.isDefined(d)&&d!==!1&&null!==d&&(t.indexOf(c)>-1&&(g="ng-"+c),o.attr(g,d),p.append(a.element(f[0].createElement("span")).attr("ng-show",n+c).html(j.errorMessage(b,c))))});var q=p.children().length,r="$invalid";q&&(r+=" && !"+e(b.formName,h.name,"$error.required")),r+=' && !formErrors["'+h.name+'"]',p.append(this.fieldErrorElement(b,r,j.errorMessage(b,"invalid")));var u="$invalid";return u+=" && !"+e(b.formName,h.name,"$error.required"),u+=' && formErrors["'+h.name+'"]',p.append(this.fieldErrorElement(b,u,j.errorMessage(b,"invalid")).html('{{formErrors["'+h.name+'"]}}')),c.append(p)},fieldErrorElement:function(b,c,d){var g=b.field,h=e(b.formName,g.name,c);return a.element(f[0].createElement("span")).attr("ng-show",h).html(d)},formMessages:function(b,c){var d=a.element(f[0].createElement("p")),e=b.formAttrs;return d.attr("ng-repeat","message in formMessages."+e.FORMKEY).attr("ng-bind","message.message").attr("ng-class",'message.error ? "text-danger" : "text-info"'),c.append(d)},errorMessage:function(a,b){var c=b+"Message",d=a.field,e=this[b+"ErrorMessage"]||this.defaultErrorMesage;return d[c]||e.call(this,a)},defaultErrorMesage:function(a){var b=a.field.type;return"Not a valid "+b},minErrorMessage:function(a){return"Must be greater than "+a.field.min},maxErrorMessage:function(a){return"Must be less than "+a.field.max},maxlengthErrorMessage:function(a){return"Too long, must be less than "+a.field.maxlength},minlengthErrorMessage:function(a){return"Too short, must be more than "+a.field.minlength},requiredErrorMessage:function(a){var b=a.field.required_error;return b||a.field.label+" is required"},processForm:function(a){return a.processForm||b.processForm}}}]).factory("standardForm",["baseForm",function(a){return d(a)}]).factory("horizontalForm",["$document","baseForm",function(b,c){function e(c){var d=g(c),e=d.children(),f=c.field.labelSpan?+c.field.labelSpan:2,h=a.element(b[0].createElement("div"));f=Math.max(2,Math.min(f,10)),a.element(e[0]).addClass("control-label col-sm-"+f),h.addClass("col-sm-"+(12-f));for(var i=1;i<e.length;++i)h.append(a.element(e[i]));return d.append(h)}function f(c){var d=h(c),e=c.field.labelSpan?+c.field.labelSpan:2,f=a.element(b[0].createElement("div")).addClass(i.inputGroupClass),g=a.element(b[0].createElement("div"));return e=Math.max(2,Math.min(e,10)),g.addClass("col-sm-offset-"+e).addClass("col-sm-"+(12-e)),f.append(g.append(d)),f}var g=c.input,h=c.button,i=d(c,{name:"horizontal",className:"form-horizontal",input:e,button:f});return i}]).factory("inlineForm",["baseForm",function(b){function c(b){var c=e(b);return a.element(c[0].getElementsByTagName("label")).addClass("sr-only"),c}var e=b.input;return d(b,{name:"inline",className:"form-inline",input:c})}]).factory("formRenderer",["$lux","$compile","formDefaults","standardForm","horizontalForm","inlineForm",function(c,d,e,f,g,j){function l(d,f,g){var j=b.getOptions(g);if(!j){var l=f[0].getElementsByTagName("script");a.forEach(l,function(a){b.globalEval(a.innerHTML)}),j=b.getOptions(g)}if(j&&j.field){var m=j.field,n={};j.field=h({},e,m),h(d,j),m=d.field,m.model?(m.name||(m.name=m.model+"form"),d.$parent[m.model]=n):(m.name||(m.name="form"),m.model=m.name+"Model"),d.formName=m.name,d.formModelName=m.model,d[d.formModelName]=n,d.formAttrs=m,d.formClasses={},d.formErrors={},d.formMessages={},d.inputModelOptions={debounce:e.debounce},d.$lux=c,m.id||(m.id=u()),d.formid=m.id,d.formCount=0,d.addMessages=function(a,b){i(a,function(a){k(a)&&(a={message:a});var c=a.field;c&&!d[d.formName].hasOwnProperty(c)?(a.message=c+" "+a.message,c=e.FORMKEY):c||(c=e.FORMKEY),b&&(a.error=b),d.formMessages[c]=[a],a.error&&c!==e.FORMKEY&&(d.formErrors[c]=a.message,d[d.formName][c].$invalid=!0)})},d.fireFieldChange=function(b){a.isDefined(d.formErrors[b])&&delete d.formErrors[b],d.$broadcast("fieldChange",n,b),d.$emit("formFieldChange",n,b)}}else c.log.error("Form data does not contain field entry")}return l.createForm=function(a,b){var c=a.field;if(c){var e=l.createElement(a);e&&(l.preCompile(a,e),d(e)(a),b.replaceWith(e),l.postCompile(a,e))}},l.createElement=function(a){var b=a.field;return this[b.layout]?this[b.layout].createElement(this,a):void c.log.error('Layout "'+b.layout+'" not available, cannot render form')},l.preCompile=function(){},l.postCompile=function(){},l.checkField=function(a){var b=this["check_"+a];if(b)b.call(this);else{var c=this.form[a];c.$valid?this.formClasses[a]="has-success":c.$dirty&&(this.formErrors[a]=a+" is not valid",this.formClasses[a]="has-error")}},l.processForm=function(a){return a.formMessages=[],a.formErrors=[],a.form.$invalid?a.showErrors():void 0},l[f.name]=f,l[g.name]=g,l[j.name]=j,l}]).directive("luxForm",["formRenderer",function(a){return{restrict:"AE",scope:{},compile:function(){return{pre:function(b,c,d){a(b,c,d)},post:function(b,c){a.createForm(b,c),b.$emit("formReady",b[b.formModelName],b)}}}}}]).directive("watchChange",[function(){return{scope:{onchange:"&watchChange"},link:function(a,b){b.on("keyup",function(){a.$apply(function(){a.onchange()})}).on("change",function(){a.$apply(function(){a.onchange()})})}}}]).directive("formatDate",[function(){return{require:"?ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return a.isString(b)||a.isNumber(b)?new Date(b):b})}}}]),b}),require(["require.config","angular","lux/forms"],function(a){"use strict";a.bootstrap("luxsite",[])}),define("app",function(){});